<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drip-Sync Monitoring</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-image: linear-gradient(rgba(239, 246, 255, 0.4), rgba(239, 246, 255, 0.4)),
                url('https://static.vecteezy.com/system/resources/previews/054/357/658/non_2x/scenic-hospital-room-with-panoramic-nature-view-free-photo.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
        }

        .nav-link {
            cursor: pointer;
        }
    </style>
</head>

<body class="min-h-screen">

    <header id="main-header" class="bg-blue-600/80 text-white shadow-lg sticky top-0 z-50 backdrop-blur-sm hidden">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-2xl md:text-3xl font-bold tracking-tight">Drip-Sync</h1>
            <nav class="flex space-x-6 relative">
                <button onclick="showPage('home')"
                    class="nav-link px-3 py-2 rounded-md font-medium hover:bg-blue-700 transition">Home</button>

                <div class="relative group">
                    <button class="px-3 py-2 rounded-md font-medium bg-blue-700 flex items-center"
                        onclick="toggleDropdown(event)">
                        Patients <span class="ml-1 text-xs">‚ñº</span>
                    </button>
                    <div id="patientDropdown"
                        class="absolute right-0 mt-2 w-72 bg-white text-gray-800 shadow-xl rounded-lg p-4 hidden z-50 border border-blue-100">
                        <h3 class="font-bold text-lg mb-3 text-blue-600 border-b pb-2">Live Status</h3>
                        <div id="dropdown-list" class="grid grid-cols-2 gap-3 text-sm">
                        </div>
                    </div>
                </div>

                <button onclick="showPage('database')"
                    class="nav-link px-3 py-2 rounded-md font-medium hover:bg-blue-700 transition">Database</button>

                <button onclick="showPage('profile')"
                    class="nav-link px-3 py-2 rounded-md font-medium hover:bg-blue-700 transition flex items-center space-x-2">
                    <img id="navProfileImg" src="https://ui-avatars.com/api/?name=User"
                        class="w-6 h-6 rounded-full border border-white/50">
                    <span>Profile</span>
                </button>

                <button id="navAdmin" onclick="showPage('admin')"
                    class="nav-link px-3 py-2 rounded-md font-medium hover:bg-purple-600 transition bg-purple-500/20 hidden border border-purple-400/30">
                    Admin Panel
                </button>

                <button onclick="window.logout()"
                    class="nav-link px-3 py-2 rounded-md font-medium hover:bg-red-600 transition bg-red-500/20 ml-4">Logout</button>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">

        <div id="urgent-alert-container" class="max-w-2xl mx-auto mb-6 hidden">
            <div
                class="bg-red-600 text-white p-4 rounded-xl shadow-2xl animate-pulse flex items-center justify-between border-2 border-white">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">‚ö†Ô∏è</span>
                    <div>
                        <p class="font-black uppercase tracking-widest">Urgent Action Required</p>
                        <p id="alert-message" class="text-sm font-medium">Saline drip is critically low!</p>
                    </div>
                </div>
                <button onclick="this.parentElement.parentElement.classList.add('hidden')"
                    class="hover:scale-110 transition">‚úï</button>
            </div>
        </div>

        </div>

        <section id="page-login" class="page-section">
            <div
                class="max-w-md mx-auto bg-white/90 rounded-2xl shadow-2xl overflow-hidden border border-white/40 backdrop-blur-md mt-20">
                <div class="bg-blue-800 text-white p-6 text-center">
                    <h1 class="text-3xl font-bold">Drip-Sync Login</h1>
                    <p class="text-blue-200 text-sm mt-1">Please authenticate to continue</p>
                </div>
                <form id="loginForm" class="p-8 space-y-6">
                    <div class="space-y-1">
                        <label class="text-xs font-bold text-gray-500 ml-1">EMAIL</label>
                        <input type="email" id="txtEmail" placeholder="admin@hospital.com"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 outline-none"
                            required>
                    </div>
                    <div class="space-y-1">
                        <label class="text-xs font-bold text-gray-500 ml-1">PASSWORD</label>
                        <input type="password" id="txtPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 outline-none"
                            required>
                    </div>
                    <div class="flex items-center space-x-2 pt-2">
                        <input type="checkbox" id="chkAdminLogin"
                            class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-400">
                        <label for="chkAdminLogin" class="text-sm text-gray-700 font-medium cursor-pointer">Login as
                            Administrator</label>
                    </div>
                    <div id="signupFields" class="space-y-4 hidden pt-2 border-t border-gray-200">
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-gray-500 ml-1">FULL NAME</label>
                            <input type="text" id="txtSignupName" placeholder="Dr. John Doe"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 outline-none">
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-gray-500 ml-1">DATE OF BIRTH</label>
                            <input type="date" id="txtSignupDob"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 outline-none">
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-gray-500 ml-1">ROLE</label>
                            <select id="txtRole"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 outline-none">
                                <option value="Doctor">Doctor</option>
                                <option value="Helper/Nurse">Helper/Nurse</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" id="btnLogin"
                        class="w-full bg-blue-800 hover:bg-blue-900 text-white font-bold py-4 rounded-lg transition transform active:scale-95 shadow-md">
                        Login via Firebase
                    </button>
                    <p class="text-center text-sm text-gray-600 mt-4">
                        <span id="authToggleText">Don't have an account?</span>
                        <button type="button" onclick="window.toggleAuthMode()"
                            class="text-blue-800 font-bold hover:underline ml-1">
                            <span id="authToggleBtn">Sign Up</span>
                        </button>
                    </p>
                </form>
            </div>
        </section>

        <section id="page-home" class="page-section hidden">
            <div
                class="max-w-2xl mx-auto bg-white/90 rounded-2xl shadow-2xl overflow-hidden border border-white/40 backdrop-blur-md">
                <div class="bg-blue-600/90 text-white p-6 text-center">
                    <h2 class="text-2xl font-bold">New Patient Registration</h2>
                    <p class="text-blue-100 text-sm mt-1">Initialize drip monitoring for a new room</p>
                </div>
                <form id="regForm" class="p-8 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-gray-500 ml-1">PATIENT NAME</label>
                            <input type="text" id="pName" placeholder="Full Name" spellcheck="false"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 outline-none"
                                required>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-gray-500 ml-1">ROOM NUMBER</label>
                            <input type="number" id="pRoom" placeholder="e.g. 101"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 outline-none"
                                required>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-gray-500 ml-1">CONTACT INFO</label>
                            <input type="tel" id="pContact" placeholder="Phone Number (10 digits)" pattern="[0-9]{10}"
                                maxlength="10" minlength="10" oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 outline-none"
                                required>
                        </div>
                    </div>
                    <button type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-lg transition transform active:scale-95 shadow-md mt-4">
                        Register & Start Monitoring
                    </button>
                </form>
            </div>
        </section>

        <section id="page-patients" class="page-section hidden">
            <div id="active-card-container" class="flex justify-center">
            </div>
        </section>

        <section id="page-database" class="page-section hidden space-y-8">
            <!-- Analytics Section -->
            <div class="bg-white/90 p-6 rounded-2xl shadow-xl border border-white/40">
                <h2 class="text-xl font-bold mb-4 text-blue-600 flex items-center">
                    <span class="mr-2">üìä</span> Volume Analytics
                </h2>
                <div class="h-64 w-full">
                    <canvas id="analyticsChart"></canvas>
                </div>
            </div>

            <!-- Database Table Section -->
            <div class="bg-white/90 rounded-2xl shadow-xl overflow-hidden border border-white/40">
                <!-- Search Controls -->
                <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 border-b">
                    <input type="text" id="searchRoom" oninput="renderDatabase()" placeholder="Search Room..."
                        class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
                    <input type="text" id="searchName" oninput="renderDatabase()" placeholder="Search Name..."
                        class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-blue-600 text-white">
                            <tr>
                                <th class="p-4 cursor-pointer hover:bg-blue-700 transition select-none"
                                    onclick="sortDatabase('roomNo')">
                                    Room <span id="sort-icon-roomNo"></span>
                                </th>
                                <th class="p-4 cursor-pointer hover:bg-blue-700 transition select-none"
                                    onclick="sortDatabase('name')">
                                    Name <span id="sort-icon-name"></span>
                                </th>
                                <th class="p-4 cursor-pointer hover:bg-blue-700 transition select-none"
                                    onclick="sortDatabase('dripLeft')">
                                    Current (mL) <span id="sort-icon-dripLeft"></span>
                                </th>
                                <th class="p-4">Rate</th>
                                <th class="p-4">Time Left</th>
                                <th class="p-4 text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody id="dbBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="page-profile" class="page-section hidden">
            <div class="max-w-md mx-auto bg-white/90 rounded-2xl shadow-xl overflow-hidden border border-white/40">
                <div class="bg-blue-600 text-white p-6 text-center">
                    <h2 class="text-2xl font-bold">My Profile</h2>
                </div>

                <div class="p-8 flex flex-col items-center space-y-6">
                    <!-- Image -->
                    <div class="relative">
                        <img id="profileImageDisplay" src="https://ui-avatars.com/api/?name=User"
                            class="w-40 h-40 rounded-full object-cover border-4 border-blue-100 shadow-lg">
                    </div>

                    <div class="text-center w-full space-y-4">
                        <!-- Role -->
                        <div>
                            <label class="block text-xs font-bold text-blue-500 uppercase tracking-wider mb-1">Official
                                Role</label>
                            <div class="bg-blue-50 text-blue-800 px-4 py-2 rounded-full font-bold inline-block"
                                id="displayRoleBadge">
                                Doctor
                            </div>
                            <!-- Hidden input to keep logic working if referenced -->
                            <input type="hidden" id="profRole">
                        </div>

                        <!-- Name -->
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Full Name</label>
                            <input type="text" id="profName"
                                class="w-full text-center text-xl font-bold text-gray-800 bg-transparent border-b border-gray-200 focus:outline-none focus:border-blue-500 pb-1"
                                disabled>
                        </div>

                        <!-- DOB -->
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Date of Birth</label>
                            <input type="date" id="profDob" class="text-center text-gray-600 bg-transparent" disabled>
                        </div>
                    </div>

                    <div class="text-xs text-gray-400 text-center mt-4">
                        To update your profile details, please contact an Administrator.
                    </div>
                </div>
            </div>
        </section>
        </section>

        <section id="page-admin" class="page-section hidden">
            <div class="max-w-6xl mx-auto bg-white/90 rounded-2xl shadow-xl overflow-hidden border border-white/40">
                <div class="bg-purple-800 text-white p-6">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h2 class="text-2xl font-bold">Admin Dashboard</h2>
                            <p class="text-purple-200 text-sm">Manage users and patients</p>
                        </div>
                        <button onclick="loadAdminData()" class="hover:rotate-180 transition duration-500">üîÑ</button>
                    </div>
                    <!-- Tab Navigation -->
                    <div class="flex space-x-2">
                        <button id="tabUsers" onclick="switchAdminTab('users')"
                            class="px-4 py-2 bg-white text-purple-800 rounded-t-lg font-bold">System Users</button>
                        <button id="tabPatients" onclick="switchAdminTab('patients')"
                            class="px-4 py-2 bg-purple-700 text-white rounded-t-lg">Patients</button>
                    </div>
                </div>

                <!-- Users Table -->
                <div id="adminUsersView" class="p-6">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="text-purple-900 border-b-2 border-purple-100">
                                    <th class="p-4">User</th>
                                    <th class="p-4">Role</th>
                                    <th class="p-4">Last Login</th>
                                    <th class="p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminUserTableBody" class="text-gray-600">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Patients Table -->
                <div id="adminPatientsView" class="p-6 hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="text-purple-900 border-b-2 border-purple-100">
                                    <th class="p-4">Room</th>
                                    <th class="p-4">Name</th>
                                    <th class="p-4">Contact</th>
                                    <th class="p-4">Current Volume</th>
                                    <th class="p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminPatientTableBody" class="text-gray-600">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <script src="index.js"></script>

    <script type="module" src="index.js"></script>
</body>

</html>